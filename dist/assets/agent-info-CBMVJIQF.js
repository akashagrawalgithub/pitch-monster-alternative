import"./modulepreload-polyfill-B5Qt9EMX.js";class l{constructor(){this.agentData=null,this.isAdmin=!1,this.originalPrompt="",this.originalSamplePitch="",this.initializeAuth(),this.initializeEventListeners(),this.loadAgentInfo()}async initializeAuth(){try{const o=localStorage.getItem("authenticated"),t=localStorage.getItem("accessToken");if(!o||!t){window.location.href="/login.html";return}const e=await fetch("/auth/check",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!e.ok){localStorage.clear(),window.location.href="/login.html";return}const a=await e.json();this.loadUserData(a.user)}catch(o){console.error("Auth check failed:",o),localStorage.clear(),window.location.href="/login.html"}}initializeEventListeners(){var o,t,e,a,n,s;document.getElementById("dashboardBtn").addEventListener("click",i=>{i.preventDefault(),window.location.href="/index.html"}),document.getElementById("logoutBtn").addEventListener("click",i=>{i.preventDefault(),this.handleLogout()}),document.getElementById("pastAnalysisBtn").addEventListener("click",i=>{i.preventDefault(),window.location.href="/past-conversations.html"}),document.getElementById("startRecordingBtn").addEventListener("click",()=>{this.startRecording()}),document.querySelectorAll(".tab").forEach(i=>{i.addEventListener("click",()=>{this.switchTab(i.dataset.tab)})}),(o=document.getElementById("savePromptBtn"))==null||o.addEventListener("click",()=>{this.savePrompt()}),(t=document.getElementById("resetPromptBtn"))==null||t.addEventListener("click",()=>{this.resetPrompt()}),(e=document.getElementById("editSamplePitchBtn"))==null||e.addEventListener("click",()=>{this.editSamplePitch()}),(a=document.getElementById("saveSamplePitchBtn"))==null||a.addEventListener("click",()=>{this.saveSamplePitch()}),(n=document.getElementById("resetSamplePitchBtn"))==null||n.addEventListener("click",()=>{this.resetSamplePitch()}),(s=document.getElementById("cancelSamplePitchBtn"))==null||s.addEventListener("click",()=>{this.cancelSamplePitchEdit()})}loadUserData(o){const t=o.email||"User",e=`${o.first_name||""} ${o.last_name||""}`.trim()||t.split("@")[0],a=e.substring(0,2).toUpperCase();document.getElementById("userName").textContent=e,document.getElementById("userAvatar").textContent=a;const n=o.role||localStorage.getItem("userRole"),s=document.getElementById("promptTab"),i=document.getElementById("usersBtn");if(n==="admin"){this.isAdmin=!0,s.style.display="block",i.style.display="flex";const r=document.getElementById("samplePitchActions");r&&(r.style.display="block");const c=document.getElementById("samplePitchDescription");c&&(c.textContent="View and edit the sample pitch script for this role-play scenario.")}else{this.isAdmin=!1,s.style.display="none",i.style.display="none";const r=document.getElementById("samplePitchActions");r&&(r.style.display="none")}}async loadAgentInfo(){const o=localStorage.getItem("selectedAgentType");if(!o){window.location.href="/index.html";return}try{const t=localStorage.getItem("accessToken");if(!t){console.error("No access token found"),window.location.href="/login.html";return}const e=await fetch("/api/db/get_agent_by_key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({agent_key:o})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();if(!a.success||!a.agent){console.error("Failed to load agent:",a.error),window.location.href="/index.html";return}const n=a.agent;document.title=n.title,document.getElementById("agentTitle").textContent=n.title,document.getElementById("breadcrumbTitle").textContent=n.title,document.getElementById("roleplayType").textContent=n.type,document.getElementById("guidelinesText").textContent=n.guidelines;const s=document.getElementById("roleplayIcon");s&&(s.innerHTML=n.icon,s.className=`info-icon ${n.iconClass}`),this.isAdmin&&this.loadAgentPrompt(n.agent_key),this.loadSamplePitch(n)}catch(t){console.error("Error loading agent from API:",t),this.showError("Failed to load agent information. Please try again later.")}}showError(o){const t=document.querySelector(".main-content");t&&(t.innerHTML=`
                    <div class="error-container" style="text-align: center; padding: 60px 20px; color: #ef4444;">
                        <div class="material-icons" style="font-size: 64px; margin-bottom: 24px;">error_outline</div>
                        <h1 style="font-size: 24px; margin-bottom: 16px; color: #1e293b;">Error Loading Agent</h1>
                        <p style="font-size: 16px; margin-bottom: 24px; color: #64748b;">${o}</p>
                        <div style="display: flex; gap: 12px; justify-content: center;">
                            <button onclick="location.reload()" style="padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                                Try Again
                            </button>
                            <button onclick="window.location.href='/index.html'" style="padding: 12px 24px; background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: 500;">
                                Back to Dashboard
                            </button>
                        </div>
                    </div>
                `)}startRecording(){localStorage.getItem("selectedAgentType")?window.location.href="/conversation.html":window.location.href="/index.html"}async handleLogout(){try{localStorage.removeItem("authenticated"),localStorage.removeItem("userEmail"),localStorage.removeItem("userName"),localStorage.removeItem("accessToken"),window.location.href="/login.html"}catch(o){console.error("Logout failed:",o),window.location.href="/login.html"}}switchTab(o){document.querySelectorAll(".tab").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[data-tab="${o}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.remove("active")}),document.getElementById(`${o}Content`).classList.add("active")}async loadAgentPrompt(o){try{const t=localStorage.getItem("accessToken"),e=await fetch("/api/db/get_agent_with_prompt",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({agent_key:o})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json();if(a.success&&a.agent){const n=document.getElementById("promptTextarea");this.originalPrompt=a.agent.prompt||"",n.value=this.originalPrompt}else throw new Error(a.error||"Failed to load agent prompt")}catch(t){console.error("Error loading agent prompt:",t),this.showPromptStatus("Error loading prompt: "+t.message,"error")}}async savePrompt(){const t=document.getElementById("promptTextarea").value.trim();if(!t){this.showPromptStatus("Prompt cannot be empty","error");return}try{const e=localStorage.getItem("accessToken"),a=localStorage.getItem("selectedAgentType"),n=await fetch("/api/db/update_agent_prompt",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({agent_key:a,prompt:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(s.success)this.originalPrompt=t,this.showPromptStatus("Prompt updated successfully","success");else throw new Error(s.error||"Failed to update prompt")}catch(e){console.error("Error updating prompt:",e),this.showPromptStatus("Error updating prompt: "+e.message,"error")}}resetPrompt(){const o=document.getElementById("promptTextarea");o.value=this.originalPrompt,this.showPromptStatus("Prompt reset to original","success")}showPromptStatus(o,t="success"){const e=document.getElementById("promptStatus");e.textContent=o,e.className=`status-message ${t}`,e.style.display="block",setTimeout(()=>{e.style.display="none"},5e3)}loadSamplePitch(o){const t=document.getElementById("samplePitchText"),e=o.sample_script||"No sample pitch available for this role-play scenario.";this.originalSamplePitch=e,t.textContent=e}editSamplePitch(){const o=document.getElementById("samplePitchView"),t=document.getElementById("samplePitchEdit"),e=document.getElementById("samplePitchActions"),a=document.getElementById("samplePitchTextarea");o.style.display="none",t.style.display="block",e.style.display="none",a.value=this.originalSamplePitch}cancelSamplePitchEdit(){const o=document.getElementById("samplePitchView"),t=document.getElementById("samplePitchEdit"),e=document.getElementById("samplePitchActions");o.style.display="block",t.style.display="none",this.isAdmin&&(e.style.display="block")}async saveSamplePitch(){const t=document.getElementById("samplePitchTextarea").value.trim();if(!t){this.showSamplePitchStatus("Sample pitch cannot be empty","error");return}try{const e=localStorage.getItem("accessToken"),a=localStorage.getItem("selectedAgentType"),n=await fetch("/api/db/update_agent_sample_script",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({agent_key:a,sample_script:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(s.success)this.originalSamplePitch=t,document.getElementById("samplePitchText").textContent=t,this.cancelSamplePitchEdit(),this.showSamplePitchStatus("Sample pitch updated successfully","success");else throw new Error(s.error||"Failed to update sample pitch")}catch(e){console.error("Error updating sample pitch:",e),this.showSamplePitchStatus("Error updating sample pitch: "+e.message,"error")}}resetSamplePitch(){const o=document.getElementById("samplePitchTextarea");o.value=this.originalSamplePitch,this.showSamplePitchStatus("Sample pitch reset to original","success")}showSamplePitchStatus(o,t="success"){const e=document.getElementById("samplePitchStatus");e.textContent=o,e.className=`status-message ${t}`,e.style.display="block",setTimeout(()=>{e.style.display="none"},5e3)}}document.addEventListener("DOMContentLoaded",function(){new l});
